<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }} - {{ site.title }}</title>
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/style.css">
</head>
<body>
    <div class="container">
        <!-- å·¦å´é‚Šæ¬„ -->
    <aside class="sidebar-left">
    <div class="site-info">
        <h2><a href="{{ site.baseurl }}/">{{ site.title }}</a></h2>
        <p>{{ site.description }}</p>
    </div>
    
    <!-- æœç´¢æ¡† -->
    <div class="search-box">
        <h3>ğŸ” æœç´¢</h3>
        <input type="text" id="searchInput" placeholder="è¼¸å…¥æ¨™ç±¤æˆ–é—œéµå­—...">
    </div>
    
    <nav class="categories">
        <h3>åˆ†é¡</h3>
        
        <div class="category-group">
            <h4>ğŸ“ è—è¡“</h4>
            <ul>
                <li><a href="{{ site.baseurl }}/categories/å‰µä½œæ ¼å­">å‰µä½œæ ¼å­</a></li>
                <li><a href="{{ site.baseurl }}/categories/æŠ€è¡“é–‹ç™¼">æŠ€è¡“é–‹ç™¼</a></li>
            </ul>
        </div>
        
        <div class="category-group">
            <h4>ğŸ“ å­¸ç¿’æ€ç¶­</h4>
            <ul>
                <li><a href="{{ site.baseurl }}/categories/å“²æ€ç­†è¨˜">å“²æ€ç­†è¨˜</a></li>
                <li><a href="{{ site.baseurl }}/categories/çŸ¥è­˜æ¢ç´¢">çŸ¥è­˜æ¢ç´¢</a></li>
            </ul>
        </div>
        
        <div class="category-group">
            <h4>ğŸ“ æ—¥å¸¸</h4>
            <ul>
                <li><a href="{{ site.baseurl }}/categories/é›œé …">é›œé …</a></li>
                <li><a href="{{ site.baseurl }}/categories/ç”Ÿæ´»é‹ä½œ">ç”Ÿæ´»é‹ä½œ</a></li>
            </ul>
        </div>
    </nav>
</aside>
        
        <!-- ä¸»è¦å…§å®¹å€ -->
        <main class="main-content">
            {{ content }}
            
            <footer>
                <p>&copy; 2025 BeeBaaSheep</p>
            </footer>
        </main>
    </div>
    <script>
let allPosts = [];

// è¼‰å…¥æ–‡ç« æ•¸æ“š
fetch('{{ site.baseurl }}/search-data.json')
    .then(response => response.json())
    .then(data => {
        allPosts = data;
        console.log('å·²è¼‰å…¥', allPosts.length, 'ç¯‡æ–‡ç« ');
    })
    .catch(err => console.error('æœç´¢æ•¸æ“šè¼‰å…¥å¤±æ•—:', err));

// æœç´¢åŠŸèƒ½
const searchInput = document.getElementById('searchInput');
if (searchInput) {
    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        
        if (searchTerm === '') {
            // æ¸…ç©ºæœç´¢,é¡¯ç¤ºæ‰€æœ‰æ–‡ç« 
            resetDisplay();
            return;
        }
        
        // æœç´¢åŒ¹é…çš„æ–‡ç« 
        const results = allPosts.filter(post => {
            return post.title.toLowerCase().includes(searchTerm) ||
                   post.content.toLowerCase().includes(searchTerm) ||
                   post.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                   post.category.toLowerCase().includes(searchTerm);
        });
        
        displaySearchResults(results, searchTerm);
    });
}

// é¡¯ç¤ºæœç´¢çµæœ
function displaySearchResults(results, searchTerm) {
    const mainContent = document.querySelector('.main-content');
    if (!mainContent) return;
    
    // å»ºç«‹æœç´¢çµæœå€
    let resultsContainer = document.getElementById('searchResults');
    if (!resultsContainer) {
        resultsContainer = document.createElement('div');
        resultsContainer.id = 'searchResults';
        mainContent.insertBefore(resultsContainer, mainContent.firstChild);
    }
    
    // éš±è—åŸæœ¬çš„å…§å®¹
    const originalContent = mainContent.querySelectorAll(':not(#searchResults)');
    originalContent.forEach(el => el.style.display = 'none');
    
    // é¡¯ç¤ºæœç´¢çµæœ
    if (results.length === 0) {
        resultsContainer.innerHTML = `
            <h2>ğŸ” æœç´¢çµæœ</h2>
            <p>æ‰¾ä¸åˆ°åŒ…å«ã€Œ${searchTerm}ã€çš„æ–‡ç« </p>
        `;
    } else {
        resultsContainer.innerHTML = `
            <h2>ğŸ” æœç´¢çµæœ</h2>
            <p>æ‰¾åˆ° ${results.length} ç¯‡ç›¸é—œæ–‡ç« </p>
            <div class="posts-grid" style="margin-top: 20px;">
                ${results.map(post => `
                    <div class="post-card">
                        <h3><a href="${post.url}">${highlightText(post.title, searchTerm)}</a></h3>
                        <time>${post.date}</time>
                        <span class="category-tag">${post.category}</span>
                        ${post.tags.length > 0 ? `
                            <div class="tags">
                                ${post.tags.map(tag => `<span class="tag" data-tag="${tag}">#${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        <p>${highlightText(post.excerpt, searchTerm)}</p>
                    </div>
                `).join('')}
            </div>
        `;
        
        // é‡æ–°ç¶å®š tag é»æ“Šäº‹ä»¶
        bindTagClicks();
    }
}

// é«˜äº®æœç´¢è©
function highlightText(text, searchTerm) {
    if (!searchTerm) return text;
    const regex = new RegExp(`(${searchTerm})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
}

// é‡ç½®é¡¯ç¤º
function resetDisplay() {
    const resultsContainer = document.getElementById('searchResults');
    if (resultsContainer) {
        resultsContainer.remove();
    }
    
    const mainContent = document.querySelector('.main-content');
    if (mainContent) {
        const originalContent = mainContent.querySelectorAll(':not(#searchResults)');
        originalContent.forEach(el => el.style.display = '');
    }
}

// Tag é»æ“Šç¯©é¸
function bindTagClicks() {
    document.querySelectorAll('.tag').forEach(tag => {
        tag.style.cursor = 'pointer';
        tag.addEventListener('click', function() {
            const tagName = this.getAttribute('data-tag');
            document.getElementById('searchInput').value = tagName;
            
            // ç¯©é¸è©² tag çš„æ–‡ç« 
            const results = allPosts.filter(post => 
                post.tags.includes(tagName)
            );
            
            displaySearchResults(results, tagName);
        });
    });
}

// é é¢è¼‰å…¥æ™‚ç¶å®š tag é»æ“Š
document.addEventListener('DOMContentLoaded', bindTagClicks);
</script>
</body>
</html>